{% include 'cabecera.html' %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card mt-4 shadow">
                <div class="card-body">
                    <h2 class="text-center">Gestión de usuarios</h2>

                    <h4 class="mt-4">Usuarios: <span id="userCount">{{ usuarios|length }}</span></h4>
                    <div class="row">
                        <div class=" col-md-6 offset-md-3 text-center">
                            {% with messages= get_flashed_messages() %}
                            {% if messages %}
                            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                <button type="button" class="btn-close" data-bs-dismiss="alert"
                                    aria-label="Close"></button>
                                {% for message in messages %}{{ message }}{% endfor %}
                            </div>
                            {% endif %}
                            {% endwith %}




                        </div>
                    </div>
                    <!-- Tabla de usuarios -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover text-center">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Apellido</th>
                                    <th>Sector</th>
                                    <th>Centro</th>
                                    <th>Correo</th>
                                    <th>Contraseña</th>
                                    <th>Rol</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for usuarioT in usuarios %}
                                <tr>
                                    <td>{{ usuarioT[1] }}</td>
                                    <td>{{ usuarioT[2] }}</td>
                                    <td>{{ usuarioT[3] }}</td>
                                    <td>{{ usuarioT[4] }}</td>
                                    <td>{{ usuarioT[5] }}</td>
                                    <td>{{ usuarioT[6] }}</td>
                                    <td>
                                        {% if usuarioT[7] == "EMPLEADO" %} USUARIO
                                        {% elif usuarioT[7] == "JEFE" %} RESPONSABLE
                                        {% else %} {{ usuarioT[7] }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if usuarioT[7] == "ADMIN" %}
                                            <button class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#eliminarModal{{ usuarioT[0] }}" disabled>
                                                Eliminar
                                            </button>
                                        {% elif usuarioT[7] == "JEFE" and usuario.roll != "ADMIN" %}
                                            <button class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#eliminarModal{{ usuarioT[0] }}" disabled>
                                                Eliminar
                                            </button>
                                        {% elif usuarioT[5] == usuario.mail %}
                                            <button class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#eliminarModal{{ usuarioT[0] }}" disabled>
                                                Eliminar
                                            </button>
                                        {% else %}
                                            <button class="btn btn-outline-danger btn-sm" data-toggle="modal" data-target="#eliminarModal{{ usuarioT[0] }}">
                                                Eliminar
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>

                                <!-- Modal Editar -->


                                <!-- Modal Eliminar -->
                                <div class="modal fade" id="eliminarModal{{ usuarioT[0] }}" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Confirmar Eliminación</h5>
                                                <button type="button" class="btn-close" data-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <p>¿Estás seguro de que deseas eliminar a <strong>{{ usuarioT[1] }} {{
                                                        usuarioT[2] }}</strong>?</p>
                                            </div>
                                            <div class="modal-footer">
                                                <form action="/eliminarUsuario" method="POST">
                                                    {% if usuario %}
                                                    <input type="hidden" name="id_perfil" value="{{ usuario.id }}" >
                                                    <input type="hidden" name="id" value="{{ usuarioT[0] }}">
                                                    <input type="hidden" name="centro" value="{{ usuarioT[4] }}">
                                                    <button type="submit" class="btn btn-danger">Eliminar</button>
                                                    {% endif %}
                                                </form>
                                                <button type="button" class="btn btn-secondary"
                                                    data-dismiss="modal">Cancelar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Formulario para agregar usuarios en una sola línea -->
                    <form action="/agregar_usuario" method="post" enctype=multipart/form-data class="p-3"
                        style="background-color: #f9f9f9; border-radius: 10px;">
                        <input type="email" class="form-control" id="email" name="usuarioM" value="{{usuario.mail}}"
                            hidden>
                        <input type="password" class="form-control" id="password" name="contraseniaM"
                            value="{{usuario.contraseña}}" hidden>
                        <h3 class="text-center mb-3">Agregar usuario</h3>

                        <div class="row align-items-center mb-2 g-2">
                            <div class="col">
                                <label for="nombre" class="form-label">Nombre:</label>
                                <input type="text" id="nombre" name="nombre" class="form-control" required>
                            </div>
                            <div class="col">
                                <label for="apellido" class="form-label">Apellido:</label>
                                <input type="text" id="apellido" name="apellido" class="form-control" required>
                            </div>
                            {% if usuario.roll != "ADMIN" %}


                            <input type="text" id="sector" name="sector" class="form-control" value="{{usuario.sector}}"
                                hidden>

<<<<<<< HEAD
=======
        <table id="userTable">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Sector</th>
                    <th>Centro</th>
                    <th>Correo</th>
                    <th>Contraseña</th>
                    <th>Rol</th>
                </tr>
            </thead>
            <tbody>
                {% for usuario in usuarios %}
                <tr>
                    <td>{{usuario[1]}}</td>
                    <td>{{usuario[2]}}</td>
                    <td>{{usuario[3]}}</td>
                    <td>{{usuario[4]}}</td>
                    <td>{{usuario[5]}}</td>
                    <td>{{usuario[6]}}</td>
                    {% if usuario[7] == "EMPLEADO" %}
                    <td>USUARIO</td>
                    {% endif %}
                    {% if usuario[7] == "JEFE" %}
                    <td>RESPONSABLE</td>
                    {% endif %}
                    {% if usuario[7] != "EMPLEADO" and usuario[7] != "JEFE" %}
                    <td>{{usuario[7]}}</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
>>>>>>> b265a5a55044b1de93c64fb8d77b11fdd76a53e5

                            <input type="text" id="centro" name="centro" class="form-control" value="{{usuario.centro}}"
                                hidden>

                            {% endif %}
                            {% if usuario.roll == "ADMIN" %}
                            <div class="col">
                                <label for="sector" class="form-label">Sector:</label>
                                <input type="text" id="sector" name="sector" class="form-control"
                                    value="{{usuario.sector}}">
                            </div>

<<<<<<< HEAD
                            <div class="col">
                                <label for="centro" class="form-label">Centro:</label>
                                <input type="text" id="centro" name="centro" class="form-control"
                                    value="{{usuario.centro}}">
                            </div>

                            {% endif %}

=======
            <label for="sector">Sector:</label>
            <select type="text" id="sector" name="sector" required>
                {% for centro in centros %}
                <option value="{{centro[2]}}">{{centro[2]}}</option>
                {% endfor %}
            </select>
            <!--<input type="text" id="sector" name="sector" required>-->

            <label for="centro">Centro:</label>
            <select type="text" id="centro" name="centro" required>
                {% for centro in centros %}
                <option value="{{centro[1]}}">{{centro[1]}} {{centro[2]}}</option>
                {% endfor %}
            </select>
            <label for="mail">Correo:</label>
            <input type="email" id="mail" name="mail" required>
>>>>>>> b265a5a55044b1de93c64fb8d77b11fdd76a53e5

                            <!--CORREGIR MAIL Y CONTRASEÑA TIENEN EL MISMO NOMBRE-->
                            <div class="col">
                                <label for="mail" class="form-label">Correo:</label>
                                <input type="email" id="mail" name="mail" class="form-control" required>
                            </div>
                            <div class="col">
                                <label for="contrasenia" class="form-label">Contraseña:</label>
                                <input type="password" id="contrasenia" name="contrasenia" class="form-control"
                                    required>
                            </div>
                            <div class="col">
                                <label for="roll" class="form-label">Rol:</label>
                                <select id="roll" name="roll" class="form-control" required>
                                    
                                    {% if usuario.roll == "JEFE" or usuario.roll == "ADMIN" %}
                                    {% if usuario.centro != "O510" %}
                                    <option value="EMPLEADO">Usuario</option>
                                    <option value="JEFE">Responsable</option>
                                    {% endif %}
                                    {% endif %}
                                    {% if usuario.centro == "O215" %} 
                                    <!--CONTADURIA-->
                                    <option value="SERVICIOS">Pago Servicios</option>
                                    <option value="DIRECTO">Pago Directo</option>
                                    {% endif %}
                                    {% if usuario.centro == "O510" %}
                                    <!--CONTROL-->
                                    <option value="CONTROL">Control</option>
                                    {% endif %}
                                    {% if usuario.roll == "PROVEEDORES" %}
                                    <option value="PROVEEDORES">Proveedores</option>
                                    {% endif %}
                                    {% if usuario.roll == "IMPUESTOS" %}
                                    <option value="IMPUESTOS">Impuestos</option>
                                    {% endif %}
                                    {% if usuario.roll == "ADMIN" %}
                                    <option value="CONTROL">Control</option>
                                    <option value="PROVEEDORES">Proveedores</option>
                                    <option value="IMPUESTOS">Impuestos</option>
                                    <option value="SERVICIOS">Pago Servicios</option>
                                    <option value="DIRECTO">Pago Directo</option>
                                    {% endif %}

                                </select>
                            </div>
                            <div class="col">
                                <div class="text-center mt-3">
                                    <button type="submit" class="btn btn-primary">Agregar Usuario</button>
                                </div>
                            </div>
                        </div>


                    </form>


<<<<<<< HEAD
=======
            <label for="roll">Rol:</label>
            
            <select type="text" id="roll" name="roll" required>
                <option value="EMPLEADO">Usuario</option>
                <option value="JEFE">Responsable</option>
                <option value="CONTROL">Control</option>
                <option value="PROVEEDORES">Proveedores</option>
                <option value="SERVICIOS">Pago Servicios</option>
                <option value="DIRECTO">Pago Directo</option>
                <option value="IMPUESTOS">Impuestos</option>
            </select>
            <div class="row">
                <div class="col">
                   <button type="submit">Agregar Usuario</button> 
                </div>
                <div class="col">
                    <a class="btn btn-primary" href="/" >Volver</a>
>>>>>>> b265a5a55044b1de93c64fb8d77b11fdd76a53e5
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'pie.html' %}